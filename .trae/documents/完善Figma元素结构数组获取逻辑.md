# 完善Figma元素结构数组获取逻辑

## 1. 分析当前实现与文档要求的差异

### 当前实现的局限性：
1. **主体元素类型**：只支持FRAME类型，文档要求支持FRAME、COMPONENT、COMPONENT_SET、GROUP四种类型
2. **子元素状态处理**：只处理了透明度为0和导出状态的元素，缺少对隐藏状态和蒙版状态的处理
3. **子元素类型处理**：没有按文档要求对不同类型元素进行差异化处理
4. **基础数据获取**：基础数据获取不完整，缺少约束规则、旋转角度等信息
5. **实例处理**：没有实现实例及其子元素不参与命名的特殊规则

### 文档要求的核心规则：
1. **主体元素类型**：支持FRAME、COMPONENT、COMPONENT_SET、GROUP
2. **子元素状态排除**：隐藏状态、蒙版状态、导出状态的元素及其子元素
3. **子元素类型处理**：
   - 组件/组件集：排除
   - 画框/分组：完整获取
   - 实例：完整获取但不参与命名
   - 文本：完整获取
   - 矢量图形：仅获取基础数据
   - 媒体与嵌入式元素：仅获取基础数据
4. **基础数据定义**：元素类型、尺寸、位置、约束规则、旋转角度、圆角、透明度、填充、描边、效果

## 2. 具体修改计划

### 修改文件：`apps/figma-plugin/src/main.ts`

#### 2.1 重命名和修改主体元素选择函数
- 重命名`getSelectedFrame`为`getSelectedElement`
- 支持四种主体元素类型的检测

#### 2.2 重命名和修改结构数据获取函数
- 重命名`getFrameStructure`为`getElementStructure`
- 支持四种主体元素类型的结构获取

#### 2.3 重构`getElements`函数
- 添加子元素状态检查（隐藏、蒙版、导出）
- 添加子元素类型处理逻辑
- 实现基础数据与完整数据的差异化获取
- 完善基础数据的获取范围

#### 2.4 修改`applyNamingSuggestions`函数
- 确保实例及其子元素不参与命名处理

#### 2.5 添加辅助函数
- 添加`isElementExcluded`函数：检查元素是否应被排除
- 添加`getBasicElementData`函数：获取元素基础数据
- 添加`getFullElementData`函数：获取元素完整数据

## 3. 技术实现要点

### 3.1 元素状态检查
- 使用`visible`属性检查隐藏状态
- 使用`isMask`属性检查蒙版状态
- 使用`exportSettings`检查导出状态

### 3.2 元素类型处理
- 对不同类型元素应用不同的处理逻辑
- 特别处理矢量图形和媒体元素的基础数据获取

### 3.3 数据结构设计
- 确保返回的数据结构符合文档要求
- 为不同类型元素提供一致的数据格式

### 3.4 向后兼容性
- 确保修改后的代码与现有功能兼容
- 保持API调用方式不变

## 4. 测试计划
- 测试四种主体元素类型的结构获取
- 测试子元素状态排除逻辑
- 测试不同类型子元素的处理逻辑
- 测试实例元素的命名排除规则
- 测试基础数据和完整数据的获取差异

通过以上修改，将使Figma插件的元素结构数组获取逻辑完全符合文档要求，确保生成的结构数组准确、规范。